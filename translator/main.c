#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char *write_text ();

int main ()
{
    FILE *file = fopen ("prog.out", "wb");

    char title[] = {0x7F, 0x45, 0x4C, 0x46, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x02, 0x00, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x80, 0x80, 0x04, 0x08, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x00, 0x20, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    size_t title_size = sizeof (title);
    fwrite (title, title_size, 1, file);

    char text_title[] = {0x01, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00, 0, 0, 0, 0, 0, 0, 0, 0, 0x05, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00};
    char data_title[] = {0x01, 0x00, 0x00, 0x00, 0, 0, 0, 0, 0, 0, 0, 0, 0x00, 0x00, 0x00, 0x00, 0x20, 0, 0, 0, 0x20, 0, 0, 0, 0x05, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    char bss_title[] = {0x01, 0x00, 0x00, 0x00, 0, 0, 0, 0, 0, 0, 0, 0, 0x00, 0x00, 0x00, 0x00, 0, 0, 0, 0, 0, 0, 0, 0, 0x05, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00};

    size_t text_size = 0;
    char *text = write_text (&text_size);
    char text3[] = {0xBB, 0x01, 0x00, 0x00, 0x00, 0xB8, 0x04, 0x00, 0x00, 0x00, 0xB9, 0xa4, 0x80, 0x04, 0x08, 0xBA, 0x0D, 0x00, 0x00, 0x00, 0xCD, 0x80, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xBB, 0x2A, 0x00, 0x00, 0x00, 0xCD, 0x80, 0x00, 0x00};
    size_t data_offsize = text_size + 0x80;
    data_title[4] = data_offsize % 256;
    data_title[5] = (data_offsize / 256) % 256;
    data_title[6] = (data_offsize / (256*256)) % 256;
    data_title[7] = (data_offsize / (256*256*256)) % 256;

    size_t data_vaddr = text_size + 0x8088080;
    data_title[8] = data_vaddr % 256;
    data_title[9] = (data_vaddr / 256) % 256;
    data_title[10] = (data_vaddr / (256*256)) % 256;
    data_title[11] = (data_vaddr / (256*256*256)) % 256;

    text_title[16] = text_size % 256;
    text_title[17] = (text_size / 256) % 256;
    text_title[18] = (text_size / (256*256)) % 256;
    text_title[19] = (text_size / (256*256*256)) % 256;
    text_title[20] = text_title[16];
    text_title[21] = text_title[17];
    text_title[22] = text_title[18];
    text_title[23] = text_title[19];

    printf ("%d %d\n", text_size, title_size);
    fwrite (text_title, sizeof (text_title), 1, file);
    fwrite (data_title, sizeof (data_title), 1, file);
    fwrite (text3, sizeof(text3), 1, file);
    char data [] = {0x48, 0x65, 0x6C,0x6C,0x6F,0x20,0x57,0x6F,0x72,0x6C,0x64,0x21,0x0A};
    fwrite (data, sizeof(data), 1, file);
    fclose (file);

    FILE *file1 = fopen ("text1.txt", "wb");
    char norm[] = {0x7F, 0x45, 0x4C, 0x46, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x02, 0x00, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x80, 0x80, 0x04, 0x08, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x00, 0x20, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xA4, 0x00, 0x00, 0x00, 0xA4, 0x80, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xBB, 0x01, 0x00, 0x00, 0x00, 0xB8, 0x04, 0x00, 0x00, 0x00, 0xB9, 0xA4, 0x80, 0x04, 0x08, 0xBA, 0x0D, 0x00, 0x00, 0x00, 0xCD, 0x80, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xBB, 0x2A, 0x00, 0x00, 0x00, 0xCD, 0x80, 0x00, 0x00, 0x48, 0x65, 0x6C, 0x6C, 0x6F, 0x20, 0x57, 0x6F, 0x72, 0x6C, 0x64, 0x21, 0x0A};
    fwrite (norm, sizeof(norm), 1, file1);
    fclose (file1);
}

char *write_text (size_t *text_size)
{
    char text[] = {0xBB, 0x01, 0x00, 0x00, 0x00, 0xB8, 0x04, 0x00, 0x00, 0x00, 0xB9, 0xa4, 0x80, 0x04, 0x08, 0xBA, 0x0D, 0x00, 0x00, 0x00, 0xCD, 0x80, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xBB, 0x5D, 0x00, 0x00, 0x00, 0xCD, 0x80, 0x00, 0x00};
    char *text_cal = (char*) calloc (0x24, sizeof (char));
    memcpy (text_cal, text, 0x24);
    *text_size = sizeof (text);
    return text_cal;
}